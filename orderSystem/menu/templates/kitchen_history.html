<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>å¨æˆ¿å†å²è®°å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7941e;
            --accent-color: #2ecc71;
            --dark-color: #333;
            --light-color: #f9f9f9;
            --gray-color: #e0e0e0;
        }
        
        body {
            background-color: #fff;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            color: var(--primary-color);
            font-size: 24px;
            margin-left: 10px;
        }
        
        .header-actions h1 {
            color: var(--primary-color);
            font-size: 24px;
            margin-left: 10px;
        }

        .logo-icon {
            font-size: 28px;
            color: var(--primary-color);
        }
        
        .cart-icon {
            position: relative;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-color);
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }
        
        /* æ¨ªå¹…æ ·å¼ */
        .banner {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .banner-content h2 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .banner-content p {
            font-size: 18px;
        }
        
        /* èœå•åˆ†ç±» */
        .categories {
            display: flex;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray-color);
        }
        
        .category {
            padding: 8px 20px;
            margin-right: 10px;
            background-color: var(--gray-color);
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .category.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* èœå•é¡¹ */
        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            
        }
        
        .menu-item {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
        }
        
        .item-image {
            height: 180px;
            width: 100%;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
        }
        
        .item-content {
            padding: 15px;
        }
        
        .item-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .item-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            height: 40px;
            overflow: hidden;
        }
        
        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-price {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .add-to-cart {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .add-to-cart:hover {
            background-color: #e55a2b;
        }
        
        /* è´­ç‰©è½¦ä¾§è¾¹æ  */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .cart-sidebar.active {
            right: 0;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-color);
        }
        
        .close-cart {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-color);
        }
        
        .cart-items {
            margin-bottom: 20px;
        }
        
        .cart-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            
        }
        
        .cart-item-image {
            width: 80px;
            height: 80px;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .cart-item-price {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .cart-item-controls {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .quantity-btn {
            width: 25px;
            height: 25px;
            background-color: var(--gray-color);
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .item-quantity {
            margin: 0 10px;
        }
        
        .remove-item {
            margin-left: auto;
            color: #ff4757;
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-color);
        }
        
        .checkout-btn {
            margin:10px;
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .checkout-btn:hover {
            background-color: #27ae60;
        }
        
        .empty-cart {
            text-align: center;
            padding: 40px 0;
            color: #666;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .banner-content h2 {
                font-size: 40px;
            }
            
            .banner-content p {
                font-size: 16px;
            }
        }
        /* ===== é€šç”¨é‡ç½® & å­—ä½“ ===== */
  :root{
    --bg: #f6f7fb;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #0f172a;   /* æ·±è‰²ä¸»è‰² */
    --accent-2: #0ea5a4; /* ç‚¹ç¼€è‰²ï¼ˆå¯æ”¹ï¼‰ */
    --line: #e6e9ef;
    --shadow: 0 6px 18px rgba(12,20,40,0.06);
    --radius: 12px;
    --radius-sm: 8px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Microsoft Yahei", Arial;
    background: linear-gradient(180deg, var(--bg), #ffffff 40%);
    color: var(--accent);
    padding:28px;
  }

  /* ===== å®¹å™¨ ===== */
  .table-wrap{
    max-width:1100px;
    margin:0 auto;
  }
  .card {
    background:var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding:18px;
    border: 1px solid var(--line);
  }

  /* ===== è¡¨å¤´åŒºåŸŸ ===== */
  .card-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
  }
  .title{
    font-size:18px;
    font-weight:600;
    letter-spacing: -0.2px;
  }
  .subtitle{
    color:var(--muted);
    font-size:13px;
  }

  /* ===== æ¡Œé¢è¡¨æ ¼æ ·å¼ ===== */
  table.minimal {
    width:100%;
    border-collapse:separate; /* ä¿ç•™é—´è·ç”¨äºåœ†è§’ */
    border-spacing:0;
    table-layout:fixed;
    font-size:14px;
  }

  thead th{
    text-align:left;
    font-weight:600;
    padding:14px 16px;
    color:var(--muted);
    font-size:13px;
    border-bottom: 1px solid var(--line);
    background: linear-gradient(180deg, rgba(0,0,0,0.01), transparent);
  }

  tbody tr{
    transition: transform .12s ease, background .12s ease;
  }

  tbody tr:hover{
    transform: translateY(-3px);
    background: rgba(14,165,164,0.03);
  }

  td{
    padding:14px 16px;
    vertical-align:middle;
    color:var(--accent);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  /* æ¡çº¹æ•ˆæœ */
  tbody tr:nth-child(odd){
    background: linear-gradient(90deg, rgba(0,0,0,0.00), rgba(0,0,0,0.00));
  }

  /* ç¬¬ä¸€åˆ—ç¨å¾®ç²—ä¸€ç‚¹ */
  tbody td:first-child{
    font-weight:600;
    color:var(--accent);
  }

  /* æ“ä½œæŒ‰é’® */
  .actions button{
    border:0;
    background:transparent;
    padding:6px 10px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
  }
  .btn-primary{
    background: linear-gradient(90deg,var(--accent-2), #0284c7);
    color:var(--accent-2);
    box-shadow: 0 4px 10px rgba(14,165,164,0.12);
  }
  .btn-ghost{
    color:var(--accent-2);
    border:1px solid rgba(14,165,164,0.12);
    background:transparent;
  }

  .status-pending {
    background-color: #fcd34d; /* é»„è‰² */
    color: #fff;
    padding: 5px 10px;
    border-radius: 10px;
  }

  .status-served {
    background-color: #22c55e; /* ç»¿è‰² */
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
  }

  .status-cooking {
    background-color: #f97316; /* æ©™è‰² */
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
  }

  .status-cancelled {
    background-color: #9ca3af; /* ç°è‰² */
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
  }

  .status-finished {
    background-color: #34d399; /* æµ…ç»¿è‰² */
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;}

  /* å›¾ç‰‡ç¼©ç•¥ */
  .thumb{
    width:48px;
    height:48px;
    border-radius:8px;
    overflow:hidden;
    display:inline-block;
    vertical-align:middle;
    margin-right:12px;
    border:1px solid var(--line);
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  /* ===== å“åº”å¼ï¼šçª„å±è½¬å¡ç‰‡å¼ ===== */
  @media (max-width:760px){
    .card-header{flex-direction:column;align-items:flex-start}
    table.minimal{display:block;width:100%}
    thead{display:none}
    tbody{display:block}
    tbody tr{
      display:block;
      margin-bottom:12px;
      border-radius: var(--radius-sm);
      padding:12px;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border:1px solid var(--line);
    }
    tbody td{
      display:flex;
      justify-content:space-between;
      padding:8px 10px;
      border-bottom: none;
    }
    tbody td::before{
      /* å¯é€‰ï¼šåœ¨æ¯è¡Œå‰æ˜¾ç¤ºå­—æ®µåï¼ˆå¦‚æœéœ€è¦ï¼‰ */
      content: attr(data-label);
      color:var(--muted);
      font-size:12px;
      margin-right:12px;
      flex:1;
      white-space:nowrap;
    }
    tbody td span.value{
      flex:1;
      text-align:right;
      font-weight:600;
      color:var(--accent);
    }
    .actions{display:flex;gap:8px}
  }

  /* å°å±æ—¶æŒ‰é’®æ›´å®¹æ˜“ç‚¹ */
  @media (max-width:420px){
    .thumb{width:40px;height:40px}
    td{padding:10px}
  }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸ½ï¸</span>
                    <h1>å¨æˆ¿åå°</h1>
                </div>
                <div class="header-actions">
                    <h1 onclick="backKitchen()">è¿”å›å¨æˆ¿åå°</h1>
                </div>
            </div>
        </div>
    </header>
 



    <!-- æ¨ªå¹… -->
    <section class="banner">
        <div class="banner-content">
            <h2>å†å²è®°å½•</h2>
        </div>
    </section>

    <div class="table-wrap">
      <div class="card">

        <div style="overflow:auto">
          <table class="minimal" aria-label="è®¢å•è¡¨">
            <thead>
              <tr>
                <th style="width:28%;">èœå“ / æ¡Œå·</th>
                <th style="width:18%;">çŠ¶æ€</th>
                <th style="width:18%;">æ•°é‡</th>
                <th style="width:18%;">åˆ›å»ºæ—¶é—´</th>
              </tr>
            </thead>
            <tbody id = 'order_list'>
              


            </tbody>
          </table>
        </div>
      </div>
    </div>
      
    <script>
        // åœ¨çª„å±æ—¶ä¸ºæ¯ä¸ª td æ·»åŠ  data-labelï¼ˆå­—æ®µåï¼‰ï¼Œä¾¿äº CSS ä¸­æ˜¾ç¤º
    (function(){
      const headers = Array.from(document.querySelectorAll('table.minimal thead th')).map(h => h.innerText.trim());
      const rows = document.querySelectorAll('table.minimal tbody tr');
      rows.forEach(row => {
        Array.from(row.children).forEach((td, i) => {
          td.setAttribute('data-label', headers[i] || '');
          // å¦‚æœæƒ³åœ¨ç§»åŠ¨ç«¯æŠŠå€¼æ”¾åœ¨ span.value å†…å¯æŒ‰éœ€åŒ…è£…ï¼Œç¤ºä¾‹ä¸­ä¸å¼ºåˆ¶
        });
      });
    })();

        const order_tables = document.getElementById('order_list');


        //è·å–è®¢å•ä¿¡æ¯
        $(document).ready(function() {
            $.ajax({
                url: '/api/get_kitchen_history_api/',  // ä½ çš„APIç«¯ç‚¹
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    // ä½¿ç”¨ä»æ•°æ®åº“è·å–çš„æ•°æ®æ¸²æŸ“èœå•
                    orderData = response;
                    console.log(orderData);
                    createOrderList(orderData);
                },
                error: function(xhr, status, error) {
                    console.error('è·å–èœå•æ•°æ®å¤±è´¥:', error);
                    // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æˆ–ä½¿ç”¨å¤‡ç”¨æ•°æ®
                }
            });
        });

        function createOrderList(orderData) {
                orderData['orders'].forEach((orderDict,index)=>{
                    console.log(orderDict)
                    orderDict['items'].forEach(item => {
                    const orderItem = document.createElement('tr');
                    const statusClass = getStatusClass(item.status);
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <td>
                            <span class="thumb"><img src="${item.image}" alt="thumb"></span>
                            ${item.name} â€” æ¡Œå· ${item.table_num}
                        </td>
                        <td class="${statusClass}  status-cell">${item.status}</td> 
                        <td>${item.quantity}</td>
                        <td>${item.created_at}</td>
                        
                    `;
            
            order_tables.appendChild(orderItem);
                                        }
                                )
                                                            }
                                            );
        };
        
        
                
                // æ ¹æ® status è¿”å›ç›¸åº”çš„ CSS ç±»
        function getStatusClass(status) {
            switch (status) {
                case 'å·²ä¸‹å•': return 'status-pending';    // é»„è‰²ï¼šå·²ä¸‹å•
                case 'åˆ¶ä½œä¸­': return 'status-cooking';    // æ©™è‰²ï¼šåˆ¶ä½œä¸­
                case 'å·²ä¸Šèœ': return 'status-served';      // ç»¿è‰²ï¼šå·²ä¸Šèœ
                case 'å·²å–æ¶ˆ': return 'status-cancelled';// ç°è‰²ï¼šå·²å–æ¶ˆ
                case 'å·²å®Œæˆ': return 'status-finished';  // æµ…ç»¿è‰²ï¼šå·²å®Œæˆ
                default: return ''; // å¦‚æœæ²¡æœ‰åŒ¹é…çš„çŠ¶æ€ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªç©ºç±»
            }
        };




        function getCSRFToken() {
            const name = 'csrftoken';
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    return cookie.substring(name.length + 1);
                }
            }
            return '';
        }

        function backKitchen(){
            window.location.href = '/kitchen';
        }
        
       


    </script>
</body>
</html>